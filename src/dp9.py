import streamlit as st
import time
import unicodedata

# 1. ãƒšãƒ¼ã‚¸å…¨ä½“ã®ã‚³ãƒ³ãƒ†ãƒŠï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰ã‚’å®šç¾©
# ã“ã‚Œã«ã‚ˆã‚Šã€å‡¦ç†ä¸­ã«ç”»é¢å…¨ä½“ã‚’ã€Œå‡¦ç†ä¸­ç”»é¢ã€ã«å·®ã—æ›¿ãˆã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™
main_container = st.empty()

def run_heavy_process(company_list):
    """
    ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®é‡ã„å‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆã™ã‚‹é–¢æ•°
    """
    # ç”»é¢å…¨ä½“ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ
    with main_container.container():
        st.warning("âš ï¸ å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¾ã§ã€ã“ã®ç”»é¢ã®ã¾ã¾ãŠå¾…ã¡ãã ã•ã„ã€‚")
        
        # st.status ã§è©³ç´°ãªé€²æ—ã‚’è¡¨ç¤º
        with st.status("ã‚·ã‚¹ãƒ†ãƒ å‡¦ç†ã‚’å®Ÿè¡Œä¸­...", expanded=True) as status:
            # ã‚¹ãƒ†ãƒƒãƒ— 1: ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°
            st.write("ä¼šç¤¾åã®å…¨è§’ãƒ»åŠè§’æ­£è¦åŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™...")
            cleaned_data = [unicodedata.normalize('NFKC', s).strip() for s in company_list]
            time.sleep(1.5) # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå†…å®¹ã‚’ç¢ºèªã§ãã‚‹ç¨‹åº¦ã®ã‚¦ã‚§ã‚¤ãƒˆ
            
            # ã‚¹ãƒ†ãƒƒãƒ— 2: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
            st.write("ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã¾ã™...")
            time.sleep(1.5)
            
            # ã‚¹ãƒ†ãƒƒãƒ— 3: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¿å­˜
            st.write("FBIã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ä¿å­˜ä¸­...")
            time.sleep(1.5)
            
            # ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å®Œäº†ã«æ›´æ–°
            status.update(label="ã™ã¹ã¦ã®å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸï¼", state="complete", expanded=False)
        
        st.balloons() # å®Œäº†ã®æ¼”å‡º
        time.sleep(2) # å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¦‹ã›ã‚‹ãŸã‚ã®å¾…æ©Ÿ
        
        # å‡¦ç†ãŒçµ‚ã‚ã£ãŸã‚‰å…ƒã®ç”»é¢ï¼ˆãƒ¡ã‚¤ãƒ³UIï¼‰ã«æˆ»ã™
        st.rerun()

def show_main_ui():
    """
    é€šå¸¸ã®å…¥åŠ›ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
    """
    with main_container.container():
        st.title("ğŸ¢ ä¼šç¤¾æƒ…å ±ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ")
        st.info("ç·¨é›†å¾Œã€ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚")
        
        # å‰å›ã® data_editor ã®ä¾‹ã‚’é©ç”¨
        df = pd.DataFrame([
            {"å…¬å¸ç±»å‹": "å—è¨—ä¼šç¤¾", "å…¬å¸åå­—": "ï¼¡æ ªå¼ä¼šç¤¾"},
            {"å…¬å¸ç±»å‹": "å§”è¨—ä¼šç¤¾", "å…¬å¸åå­—": "ï¼¢æ ªå¼ä¼šç¤¾"}
        ])
        
        edited_df = st.data_editor(df, num_rows="dynamic", use_container_width=True, hide_index=True)
        
        if st.button("ğŸš€ ãƒ‡ãƒ¼ã‚¿ã‚’ã‚µãƒ¼ãƒãƒ¼ã«ä¿å­˜"):
            # ä¿å­˜ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ã€å‡¦ç†ç”¨é–¢æ•°ã‚’å‘¼ã³å‡ºã™
            names = edited_df["å…¬å¸åå­—"].tolist()
            run_heavy_process(names)

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•
if __name__ == "__main__":
    import pandas as pd # å¿µã®ãŸã‚ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    show_main_ui()